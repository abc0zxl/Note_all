## 订单状态

1.下单后15分钟内必须支付，超时就会变成超时订单

2.然后就要取消订单（程序自动执行）

3.后台一直处于派送中的订单处理（每天定点处理）

## 提醒功能

1.来单提醒

2.客户催单


## Spring Task

Spring Task是Spring框架提供的任务调度工具

**作用**：可以按照约定的时间自动执行某个代码逻辑

**应用**：

* 信用卡每月还款提醒
* 银行贷款每月题型
* 火车票系统处理未支付订单
* 纪念日的祝贺通知

### cron表达式

他就是个字符串，通过cron表达式可以定义**任务触发的时间**

**构成规则**：分成了6，7个域，空格分隔开，每个域代表一个含义。

**组成**：秒、分钟、小时、日，月，周，年

**表达式表示**：

![image.png](/assets/0d417ec4-5a66-4bd0-b595-dc4be5017cd6.png)

1.**表达式快捷生成工具**：cron.qqe2.com

2.**表达式快捷生成**：这里可以直接去下载一个叫 CronGenerator 的 IDEA 插件，2022.2 版本以上都可以用，直接就在 IDE 里面生成了，很方便，不用更换浏览器



### 实现步骤

1.**导入坐标**：在spring-starter已经有了

2.**开启注解**：在启动类编写注解@#nableScheduling

3.**自定义任务类**：

* 单独放到一个包中
* 加类注解@component
* 加方法注解@Scheduled(cron="")
* 编写任务方法。

![image.png](/assets/413d4cf2-2e94-4620-904e-f602f4f803f2.png)

### 



### **订单状态处理**

**问题**：

* 下单后一直处于待支付状态
* 订单一直处于派送中

**解决**：

1.支付状态问题：每分钟检查一次，知否存在超时订单，如果存在，该订单状态就为**已取消**



#### 待支付的订单处理

**执行步骤**

1.**sql条件查找**：就找超时的数量

![image.png](/assets/ac911beb-3f8b-4003-82d5-e2347ab2d81a.png)

2.**修改状态**：

直接用for来修改状态，和取消原因，取消时间。


#### 一直处于派送中的订单处理

**处理步骤**

1.设置一个时间点，每天在这个时间点就处理所有派送中订单。

2.如果在这个时间点，这个订单的派送时间超过1小时，就修改订单状态
