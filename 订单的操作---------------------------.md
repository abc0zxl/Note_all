# 错误

1.**BeanUtils**：不用管左右两边参数是否相同，或者互为子集。参数数量问题不会报错，他只会将匹配相同的参数赋值过去。

## 订单状态

1.下单后15分钟内必须支付，超时就会变成超时订单

2.然后就要取消订单（程序自动执行）

3.后台一直处于派送中的订单处理（每天定点处理）

## 提醒功能

1.来单提醒

2.客户催单

## Spring Task

Spring Task是Spring框架提供的任务调度工具

**作用**：可以按照约定的时间自动执行某个代码逻辑

**应用**：

* 信用卡每月还款提醒
* 银行贷款每月题型
* 火车票系统处理未支付订单
* 纪念日的祝贺通知

### cron表达式

他就是个字符串，通过cron表达式可以定义**任务触发的时间**

**构成规则**：分成了6，7个域，空格分隔开，每个域代表一个含义。

**组成**：秒、分钟、小时、日，月，周，年

**表达式表示**：

![image.png](/assets/0d417ec4-5a66-4bd0-b595-dc4be5017cd6.png)

1.**表达式快捷生成工具**：cron.qqe2.com

2.**表达式快捷生成**：这里可以直接去下载一个叫 CronGenerator 的 IDEA 插件，2022.2 版本以上都可以用，直接就在 IDE 里面生成了，很方便，不用更换浏览器

### 实现步骤

1.**导入坐标**：在spring-starter已经有了

2.**开启注解**：在启动类编写注解@#nableScheduling

3.**自定义任务类**：

* 单独放到一个包中
* 加类注解@component
* 加方法注解@Scheduled(cron="")
* 编写任务方法。

![image.png](/assets/413d4cf2-2e94-4620-904e-f602f4f803f2.png)

### 

### **订单状态处理**

**问题**：

* 下单后一直处于待支付状态
* 订单一直处于派送中

**解决**：

1.支付状态问题：每分钟检查一次，知否存在超时订单，如果存在，该订单状态就为**已取消**

#### 待支付的订单处理

**执行步骤**

1.**sql条件查找**：就找超时的数量

![image.png](/assets/ac911beb-3f8b-4003-82d5-e2347ab2d81a.png)

2.**修改状态**：

直接用for来修改状态，和取消原因，取消时间。

#### 一直处于派送中的订单处理

**处理步骤**

1.设置一个时间点，每天在这个时间点就处理所有派送中订单。

2.如果在这个时间点，这个订单的派送时间超过1小时，就修改订单状态

# WebSocket

他是基于TCP的一种新的**网络协议**，

**作用**：实现了浏览器和服务器的**全双工通信**，浏览器和服务器只需要完成一次握手，两者之间就能创建**持久性的**连接，并进行**双向数据传输**

![image.png](/assets/57be91d9-8f4a-44ba-b333-9b6e70175cdc.png)

1.**原来的Http协议**：他是单向的，只有**单向的**请求和响应，

2.**WebSocket**：他是双向的，两边都能互相发送数据。

3.**两者都是基于TCP连接**

**应用场景**：

* 聊天窗口，互相发消息
* 网页聊天
* 视频弹幕
* 体育实况更新
* 股票基金实时报价实时更新

### 网页传递信息实现步骤

1.编写传递消息的html，在**苍穹外卖**的资料文件中

2.**导入坐标**

3.**导入组件WebSocketServer**：用于通信

* 新建一个包websocket放这个工具
* 重要注解
* @ServerEndpoint("")
* @OnOpen
* @OnMessage
* @OnClose

4.**导入配置类**：注册服务端组件

* @Configuration
* 创建组件

# 来单提醒

支付成功后，需要第一时间通知外卖商家

* 语音播报
* 弹出提示框
* 给客户发提示

![image.png](/assets/44b6cd09-3f73-4d72-9e83-3ddcb9617b8c.png)

主方法：发送到服务器端

![image.png](/assets/62a02f1b-e9c5-433f-93d6-5a9f9950e537.png)

# ！！！！！！注意这里的代码是给商户浏览器发的

订单状态，订单id，订单号

WebSocket是**服务器和浏览器之间的通信**，不是用户端和商户端的互相传递消息。

这部分要单独发送到浏览器页面，做到提醒效果。所以要用到websocket

# 客户催单

**实现步骤**

1.设置WebSocket连接

2.**客户点击催单按钮**

3.服务器判断是**催单**还是**来单提醒**

* 中途判断一下是否有该订单。

4.**将发送数据给浏览器**：格式为JSON

![image.png](/assets/0b052902-8136-4479-9d63-b7a537fe08ff.png)

# 订单号

1.**订单ID**：这个就是雪花值

2.**订单编号**：这个就是有固定字符串组成的：**时间（年月日时分）+ id后4位+3位随机值**
